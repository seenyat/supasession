<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shader Demo</title>
    <style>
      body {
        margin: 0;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="shaderCanvas"></canvas>
    <script>
      const canvas = document.getElementById('shaderCanvas');
      const gl = canvas.getContext('webgl');

      const vertexShader = gl.createShader(gl.VERTEX_SHADER);
      gl.shaderSource(
        vertexShader,
        `
            attribute vec4 position;
            void main() {
                gl_Position = position;
            }
        `
      );
      gl.compileShader(vertexShader);

      const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(
        fragmentShader,
        `
            precision mediump float;
            uniform vec2 iResolution;
            uniform float iTime;
            void mainImage(out vec4 O, vec2 u);
            
            void mainImage(out vec4 O, vec2 u) {

vec2 R = iResolution.xy,
     U = 5.*( 2.*u - R ) / R.y,
     I = floor(U)+.5,
     F = fract(U)-.5,
     H = fract(1e4*sin(I*mat2(R-17.,R+71.)));

float p = 15./R.y, l = length(F), L = length(U), i = length(I);
O = vec4( mix( .5,
               .5+.5* sin(- 20.*iTime* sign(H.x-.5)  - 6.28*H.y - ( l > .4 - 2.*p* abs(dot(U,F))/L/l ?  sign(L-i): 0.) ),
               smoothstep(0.,-p, l-.4) ) );

}

            void main() {
                vec2 uv = gl_FragCoord.xy / iResolution;
                vec4 color;
                mainImage(color, uv);
                gl_FragColor = color;
            }
        `
      );
      gl.compileShader(fragmentShader);

      const program = gl.createProgram();
      gl.attachShader(program, vertexShader);
      gl.attachShader(program, fragmentShader);
      gl.linkProgram(program);
      gl.useProgram(program);

      const positionLocation = gl.getAttribLocation(program, 'position');
      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      gl.bufferData(
        gl.ARRAY_BUFFER,
        new Float32Array([200, 200, 200, -1, -1, 1, -1, 1, 1, -1, 1, 1]),
        gl.STATIC_DRAW
      );
      gl.enableVertexAttribArray(positionLocation);
      gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

      const iResolutionLocation = gl.getUniformLocation(program, 'iResolution');
      const iTimeLocation = gl.getUniformLocation(program, 'iTime');
      const iTimeDeltaLocation = gl.getUniformLocation(program, 'iTimeDelta');
      const iFrameRateLocation = gl.getUniformLocation(program, 'iFrameRate');
      const iFrameLocation = gl.getUniformLocation(program, 'iFrame');
      const iChannelTimeLocation = gl.getUniformLocation(
        program,
        'iChannelTime'
      );
      const iChannelResolutionLocation = gl.getUniformLocation(
        program,
        'iChannelResolution'
      );
      const iMouseLocation = gl.getUniformLocation(program, 'iMouse');
      const iChannel0Location = gl.getUniformLocation(program, 'iChannel0');
      const iChannel1Location = gl.getUniformLocation(program, 'iChannel1');
      const iChannel2Location = gl.getUniformLocation(program, 'iChannel2');
      const iChannel3Location = gl.getUniformLocation(program, 'iChannel3');
      const iDateLocation = gl.getUniformLocation(program, 'iDate');

      function render(time) {
        canvas.width = innerWidth;
        canvas.height = innerHeight;
        gl.viewport(0, 0, canvas.width, canvas.height);

        gl.uniform3f(iResolutionLocation, canvas.width, canvas.height, 1.0);
        gl.uniform1f(iTimeLocation, time * 0.001);
        gl.uniform1f(iTimeDeltaLocation, 1.0 / 60.0); // Assuming 60 FPS
        gl.uniform1f(iFrameRateLocation, 60); // Assuming 60 FPS
        gl.uniform1i(iFrameLocation, Math.floor(time * 0.06)); // Assuming 60 FPS
        gl.uniform4f(iChannelTimeLocation, 0, 0, 0, 0); // Set all channel times to 0
        gl.uniform4f(iChannelResolutionLocation, 0, 0, 0, 0); // Set all channel resolutions to 0

        const currentDate = new Date();
        gl.uniform4f(
          iDateLocation,
          currentDate.getFullYear(),
          currentDate.getMonth() + 1,
          currentDate.getDate(),
          currentDate.getHours() * 3600 +
            currentDate.getMinutes() * 60 +
            currentDate.getSeconds() +
            currentDate.getMilliseconds() * 0.001
        );

        gl.drawArrays(gl.TRIANGLES, 0, 6);
        requestAnimationFrame(render);
      }

      requestAnimationFrame(render);
    </script>
  </body>
</html>
